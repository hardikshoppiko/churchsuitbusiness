{"version":3,"sources":["../../../src/app/api/affiliate/register/route.js","../../../node_modules/next/dist/esm/build/templates/app-route.js"],"sourcesContent":["import { db } from \"@/lib/db\";\nimport {\n  generateSalt,\n  ocHashPassword,\n  dbEscape,\n  stripWebsite,\n  isEmail,\n  isTenDigitPhone,\n  ocSerialize,\n  isTruthy,\n  getClientIp,\n} from \"@/lib/db-utils\";\n\n\nfunction stableStringify(obj) {\n  if (!obj || typeof obj !== \"object\") return JSON.stringify(obj ?? {});\n  const sorted = {};\n  for (const k of Object.keys(obj).sort()) sorted[k] = obj[k];\n  return JSON.stringify(sorted);\n}\n\nfunction hashPayload(obj) {\n  const s = stableStringify(obj);\n  return crypto.createHash(\"sha1\").update(s).digest(\"hex\");\n}\n\n/**\n * Idempotent activity logger:\n * - Skips duplicate logs when same affiliate_id + key + same payload hash\n *   is already logged within `dedupeSeconds` window.\n */\nasync function recordAffiliateActivity(affiliate_id, key, dataObj, ip, dedupeSeconds = 120) {\n  const affId = Number(affiliate_id || 0);\n  if (!affId) return;\n\n  const k = String(key || \"\").trim();\n  if (!k) return;\n\n  const payload = dataObj ?? {};\n  const payloadHash = hashPayload(payload);\n\n  // ✅ check latest same key for this affiliate\n  const [rows] = await db.query(`\n    SELECT activity_id, data, date_added\n    FROM affiliate_activity\n    WHERE affiliate_id='${affId}'\n      AND \\`key\\`='${dbEscape(k)}'\n    ORDER BY activity_id DESC\n    LIMIT 1\n  `);\n\n  if (rows?.length) {\n    const last = rows[0];\n\n    // last.data is stored JSON string\n    let lastHash = \"\";\n    try {\n      const parsed = JSON.parse(String(last.data || \"{}\"));\n      lastHash = parsed?._hash || \"\";\n    } catch {}\n\n    // compare time window (server-side)\n    const [timeRows] = await db.query(`\n      SELECT (TIMESTAMPDIFF(SECOND, '${dbEscape(last.date_added)}', NOW())) AS diff_sec\n    `);\n    const diffSec = Number(timeRows?.[0]?.diff_sec || 999999);\n\n    // ✅ if same payload + recent → skip duplicate insert\n    if (lastHash === payloadHash && diffSec <= dedupeSeconds) {\n      // still update affiliate.date_update to reflect activity ping (optional)\n      await db.query(`\n        UPDATE affiliate SET date_update=NOW()\n        WHERE affiliate_id='${affId}'\n        LIMIT 1\n      `);\n      return;\n    }\n  }\n\n  // store payload + internal hash\n  const finalData = {\n    ...payload,\n    _hash: payloadHash,\n  };\n\n  await db.query(`\n    INSERT INTO affiliate_activity SET\n      affiliate_id='${affId}',\n      \\`key\\`='${dbEscape(k)}',\n      \\`data\\`='${dbEscape(JSON.stringify(finalData))}',\n      ip='${dbEscape(ip || \"\")}',\n      date_added=NOW()\n  `);\n\n  // keep affiliate \"last activity\" updated\n  await db.query(`\n    UPDATE affiliate SET date_update=NOW()\n    WHERE affiliate_id='${affId}'\n    LIMIT 1\n  `);\n}\n\n/**\n * INSERT INTO affiliate_extension (OpenCart style)\n */\nasync function installModule(type, code, affiliate_id) {\n  const sql = `\n    INSERT INTO affiliate_extension SET\n      affiliate_id='${Number(affiliate_id)}',\n      \\`type\\`='${dbEscape(type)}',\n      \\`code\\`='${dbEscape(code)}'\n  `;\n  const [res] = await db.query(sql);\n  return res.insertId;\n}\n\n/**\n * INSERT affiliate settings (OpenCart style)\n * - Deletes existing entries for affiliate+code\n * - Inserts each key/value pair\n */\nasync function addAffiliateSettings(code, data, affiliate_id = 0) {\n  await db.query(`\n    DELETE FROM affiliate_setting\n    WHERE affiliate_id='${Number(affiliate_id)}'\n      AND \\`code\\`='${dbEscape(code)}'\n  `);\n\n  for (const [key, value] of Object.entries(data || {})) {\n    if (!String(key).startsWith(code)) continue;\n\n    if (value === null || value === undefined || typeof value !== \"object\") {\n      await db.query(`\n        INSERT INTO affiliate_setting SET\n          affiliate_id='${Number(affiliate_id)}',\n          \\`code\\`='${dbEscape(code)}',\n          \\`key\\`='${dbEscape(key)}',\n          \\`value\\`='${dbEscape(value)}',\n          serialized='0'\n      `);\n    } else {\n      const serialized = ocSerialize(value);\n\n      await db.query(`\n        INSERT INTO affiliate_setting SET\n          affiliate_id='${Number(affiliate_id)}',\n          \\`code\\`='${dbEscape(code)}',\n          \\`key\\`='${dbEscape(key)}',\n          \\`value\\`='${dbEscape(serialized)}',\n          serialized='1'\n      `);\n    }\n  }\n}\n\nasync function getAffiliateBasicSettings() {\n  const sql = `SELECT \\`key\\`, \\`value\\` FROM affiliate_basic_setting WHERE \\`code\\`='affiliate_basic'`;\n  const [rows] = await db.query(sql);\n\n  if (!rows || rows.length === 0) return {};\n\n  const settings = {};\n  for (const row of rows) settings[row.key] = row.value;\n  return settings;\n}\n\nasync function addAffiliateCategory(affiliate_id) {\n  const categories = [];\n\n  for (let i = 0; i < 2; i++) {\n    const name = `Category ${i + 1}`;\n\n    const sql = `\n      INSERT INTO category SET\n      category_old_id=0,\n      category_child_old_id=0,\n      affiliate_id='${Number(affiliate_id)}',\n      name='${dbEscape(name)}',\n      name_affiliate='',\n      description='Category',\n      meta_title='Category',\n      meta_description='Category',\n      meta_keyword='Category',\n      shopify_tag='',\n      export_product_to_shopify=0,\n      is_shopify_product_update_forcefully=0,\n      dcs_brief='',\n      dcs_detail='',\n      dcs_short='',\n      is_description_mobile=0,\n      is_not_for_wholesale=0,\n      is_not_for_affiliate=0,\n      image='',\n      image_path='',\n      image_affiliate='',\n      folder_name='',\n      parent_id=0,\n      top=1,\n      is_catalog=0,\n      is_special=0,\n      is_women=0,\n      is_men=0,\n      is_accessories=0,\n      \\`column\\`=0,\n      sort_order='${i + 1}',\n      status=1,\n      date_added=NOW(),\n      date_modified=NOW()\n    `;\n\n    const [res] = await db.query(sql);\n    const category_id = res.insertId;\n\n    categories.push(category_id);\n\n    await db.query(`\n      INSERT INTO category_path SET\n        category_id='${Number(category_id)}',\n        path_id='${Number(category_id)}',\n        level='0'\n    `);\n  }\n\n  return categories;\n}\n\nasync function addAffiliateProducts(affiliate_id, categories = []) {\n  const products = [];\n\n  for (let i = 0; i < 4; i++) {\n    const name = `Product ${i + 1}`;\n\n    const sql = `\n      INSERT INTO product SET\n        product_old_id=0,\n        affiliate_id='${Number(affiliate_id)}',\n        name='${dbEscape(name)}',\n        description='${dbEscape(name)}',\n        meta_title='${dbEscape(name)}',\n        meta_description='${dbEscape(name)}',\n        meta_keyword='${dbEscape(name)}',\n        model='',\n        sku='',\n        upc='',\n        ean='',\n        jan='',\n        isbn='',\n        mpn='',\n        location='',\n        quantity='1000',\n        stock_status_id=0,\n        image='affiliate_images/demo-product.jpg',\n        image_path='',\n        file_name='',\n        is_large_image_found=0,\n        is_image_background_is_white=0,\n        video='',\n        manufacturer_id=0,\n        brand_id=0,\n        shipping=1,\n        price='100',\n        price_retail='125',\n        price_original='150',\n        is_men=0,\n        points=0,\n        tax_class_id=0,\n        date_available=NOW(),\n        weight='0.000',\n        weight_class_id=0,\n        length='0.000',\n        width='0.000',\n        height='0.000',\n        length_class_id=0,\n        subtract=0,\n        minimum='1',\n        sort_order='${i + 1}',\n        status='1',\n        viewed=0,\n        is_product_modified=0,\n        is_web_scrape_product_verify=0,\n        date_added=NOW(),\n        date_modified=NOW()\n    `;\n\n    const [res] = await db.query(sql);\n    const product_id = res.insertId;\n\n    products.push(product_id);\n\n    if (categories && categories.length) {\n      for (const category_id of categories) {\n        await db.query(`\n          INSERT INTO product_to_category SET\n            product_id='${Number(product_id)}',\n            category_id='${Number(category_id)}'\n        `);\n      }\n    }\n  }\n\n  return products;\n}\n\nasync function addAffiliatePages(affiliate_id, pages = []) {\n  for (const page of pages) {\n    const sql = `\n      INSERT INTO information SET\n        affiliate_id='${Number(affiliate_id)}',\n        title='${dbEscape(page.name)}',\n        description='${dbEscape(page.description)}',\n        description_top='',\n        short='',\n        meta_title='${dbEscape(page.meta_title)}',\n        meta_description='${dbEscape(page.meta_description)}',\n        meta_keyword='',\n        image='',\n        image_mobile='',\n        top='0',\n        bottom='1',\n        affiliate=0,\n        catalog='',\n        trending_product_title='',\n        trending_product_status=0,\n        trending_categories='',\n        sort_order='${Number(page.sort_order || 0)}',\n        status='${Number(page.status || 0)}'\n    `;\n    await db.query(sql);\n  }\n}\n\nasync function addLargeBanners(affiliate_id) {\n  const sliders = {\n    code: \"slideshow\",\n    module_name: \"Home Page Slideshow\",\n    width: \"1900\",\n    height: \"700\",\n    sort_order: \"1\",\n    status: \"1\",\n    slideshow_images: [\n      { title: \"First\", link: \"index.php?route=product/catalog\", image: \"catalog/banner/1.jpg\", sort_order: 1 },\n      { title: \"Second\", link: \"index.php?route=product/catalog\", image: \"catalog/banner/2.jpg\", sort_order: 2 },\n    ],\n  };\n\n  const settings = ocSerialize(sliders);\n\n  const sql = `\n    INSERT INTO page_builder SET\n      affiliate_id='${Number(affiliate_id)}',\n      page_id=0,\n      module_name='${dbEscape(sliders.module_name)}',\n      \\`code\\`='${dbEscape(sliders.code)}',\n      \\`setting\\`='${dbEscape(settings)}',\n      location_type=0,\n      sort_order='${Number(sliders.sort_order)}',\n      status='${Number(sliders.status)}',\n      date_added=NOW(),\n      date_modified=NOW(),\n      user_added=0,\n      user_modified=0,\n      is_delete=0\n  `;\n  await db.query(sql);\n}\n\nasync function addSmallBanners(affiliate_id) {\n  const banners = {\n    code: \"banner\",\n    module_name: \"Home Page Banners\",\n    width: \"380\",\n    height: \"270\",\n    sort_order: \"2\",\n    status: \"1\",\n    banner_images: [\n      { title: \"Womens\", link: \"index.php?route=product/womens\", image: \"catalog/banner-small/1.jpg\", sort_order: 1 },\n      { title: \"Mens\", link: \"index.php?route=product/mens\", image: \"catalog/banner-small/2.jpg\", sort_order: 2 },\n      { title: \"Accessories\", link: \"index.php?route=product/accessories\", image: \"catalog/banner-small/3.jpg\", sort_order: 3 },\n    ],\n  };\n\n  const settings = ocSerialize(banners);\n\n  const sql = `\n    INSERT INTO page_builder SET\n      affiliate_id='${Number(affiliate_id)}',\n      page_id=0,\n      module_name='${dbEscape(banners.module_name)}',\n      \\`code\\`='${dbEscape(banners.code)}',\n      \\`setting\\`='${dbEscape(settings)}',\n      location_type=0,\n      sort_order='${Number(banners.sort_order)}',\n      status='${Number(banners.status)}',\n      date_added=NOW(),\n      date_modified=NOW(),\n      user_added=0,\n      user_modified=0,\n      is_delete=0\n  `;\n  await db.query(sql);\n}\n\nasync function getChildCategories(parent_id) {\n  const sql = `\n    SELECT category_id\n    FROM category\n    WHERE parent_id='${Number(parent_id)}' AND status=1\n    ORDER BY sort_order ASC, category_id ASC\n  `;\n  const [rows] = await db.query(sql);\n  return (rows || []).map((r) => Number(r.category_id));\n}\n\nfunction pickRandom(arr = []) {\n  if (!arr.length) return null;\n  const idx = Math.floor(Math.random() * arr.length);\n  return arr[idx];\n}\n\nasync function addCategoryProductsModule(affiliate_id) {\n  const women_categories = await getChildCategories(1);\n  const accessaries_category = await getChildCategories(434);\n  const men_categories = await getChildCategories(493);\n\n  const selectedWomen = pickRandom(women_categories);\n  const selectedAccessories = pickRandom(accessaries_category);\n  const selectedMen = pickRandom(men_categories);\n\n  const category_product_module = {\n    code: \"category_product_module\",\n    module_name: \"Latest Category Products\",\n    category: \"\",\n    categories: [],\n    limit: 4,\n    width: 200,\n    height: 200,\n    sort_order: 3,\n    status: 1,\n  };\n\n  if (selectedWomen) category_product_module.categories.push(selectedWomen);\n  if (selectedAccessories) category_product_module.categories.push(selectedAccessories);\n  if (selectedMen) category_product_module.categories.push(selectedMen);\n\n  const setting = ocSerialize(category_product_module);\n\n  const sql = `\n    INSERT INTO page_builder SET\n      affiliate_id='${Number(affiliate_id)}',\n      page_id=0,\n      module_name='${dbEscape(category_product_module.module_name)}',\n      \\`code\\`='${dbEscape(category_product_module.code)}',\n      \\`setting\\`='${dbEscape(setting)}',\n      location_type=0,\n      sort_order='${Number(category_product_module.sort_order)}',\n      status='${Number(category_product_module.status)}',\n      date_added=NOW(),\n      date_modified=NOW(),\n      user_added=0,\n      user_modified=0,\n      is_delete=0\n  `;\n  await db.query(sql);\n}\n\n/** helper: check affiliate exists */\nasync function getAffiliateById(affiliate_id) {\n  const affId = Number(affiliate_id);\n  if (!affId) return null;\n  const [rows] = await db.query(`SELECT * FROM affiliate WHERE affiliate_id=${affId} LIMIT 1`);\n  return rows?.[0] || null;\n}\n\n/** helper: safe placeholder store name */\nfunction makeTempStoreName() {\n  return `TEMP-${Date.now()}`;\n}\n\nasync function godaddyCheckDomain(domainRaw) {\n  const json = {};\n\n  const domain_name = String(domainRaw || \"\")\n    .trim()\n    .replace(/^https?:\\/\\//i, \"\")\n    .replace(/^www\\./i, \"\");\n\n  // Validate like PHP (domain url must be valid)\n  const domainOk = /^[a-z0-9.-]+\\.[a-z]{2,}$/i.test(domain_name);\n  if (!domainOk) {\n    json.error = \"Warning: Please enter valid URL!\";\n    return json;\n  }\n\n  const API_KEY = process.env.GODADDY_API_KEY;\n  const API_SECRET = process.env.GODADDY_API_SECRET;\n  const BASE_URL = process.env.GODADDY_BASE_URL || \"https://api.godaddy.com\";\n\n  if (!API_KEY || !API_SECRET) {\n    json.error = \"GoDaddy API credentials missing\";\n    return json;\n  }\n\n  const header = {\n    Authorization: `sso-key ${API_KEY}:${API_SECRET}`,\n    \"Content-Type\": \"application/json\",\n  };\n\n  // 1) availability\n  const url = `${BASE_URL}/v1/domains/available?domain=${encodeURIComponent(domain_name)}&checkType=FAST&forTransfer=false`;\n\n  const res = await fetch(url, { method: \"GET\", headers: header, cache: \"no-store\" });\n  const final_result = await res.json().catch(() => ({}));\n\n  // Similar to your PHP check\n  if (final_result?.code === \"ACCESS_DENIED\") {\n    json.error = \"GoDaddy ACCESS_DENIED\";\n    return json;\n  }\n\n  if (final_result?.available === true) {\n    json.success = true;\n    json.domain_found = \"Congratulation, domain available!\";\n    return json;\n  }\n\n  // Not available → suggestions\n  json.error = \"Warning: Domain not available!\";\n  json.domain_not_available = true;\n\n  // suggestion query: first token before dot (like PHP)\n  const base = domain_name.replace(/^www\\./i, \"\");\n  const parts = base.split(\".\");\n  const keyword = parts[0] || base;\n\n  const suggestUrl =\n    `${BASE_URL}/v1/domains/suggest?query=${encodeURIComponent(keyword)}` +\n    `&sources=keywordspin&waitMs=1000`;\n\n  const sres = await fetch(suggestUrl, { method: \"GET\", headers: header, cache: \"no-store\" });\n  const suggestions = await sres.json().catch(() => []);\n\n  if (Array.isArray(suggestions) && suggestions.length > 0) {\n    const list = [];\n    for (const item of suggestions) {\n      const d = item?.domain;\n      if (typeof d === \"string\" && d.toLowerCase().endsWith(\".com\")) {\n        list.push(d);\n      }\n    }\n    if (list.length) json.domain_suggestions = list;\n  }\n\n  return json;\n}\n\nexport async function POST(req) {\n  const body = await req.json().catch(() => ({}));\n\n  // domain availability action (NO new route)\n  if (String(body?.action || \"\") === \"check_domain\") {\n    const domain_name = body?.domain_name || \"\";\n    const result = await godaddyCheckDomain(domain_name);\n    return Response.json(result);\n  }\n\n  const step = Number(body.step || 0);\n\n  if (![1, 2, 3].includes(step)) {\n    return Response.json({ message: \"step is required (1,2,3)\" }, { status: 400 });\n  }\n\n  // shared\n  const ip = getClientIp(req);\n\n  // ------------------------------------------------------------\n  // STEP 1: create OR update affiliate with personal info only\n  // ------------------------------------------------------------\n  if (step === 1) {\n    const firstname = dbEscape(body.firstname);\n    const lastname = dbEscape(body.lastname);\n    const email = dbEscape(body.email).toLowerCase();\n    const telephone = dbEscape(body.telephone);\n\n    const incomingAffiliateId = Number(body?.affiliate_id || 0) || 0;\n\n    // validations (only personal)\n    if (!firstname) return Response.json({ message: \"firstname is required\" }, { status: 400 });\n    if (firstname.length < 1 || firstname.length > 32) {\n      return Response.json({ message: \"First name must be between 1 to 32 characters\" }, { status: 400 });\n    }\n\n    if (!lastname) return Response.json({ message: \"lastname is required\" }, { status: 400 });\n    if (lastname.length < 1 || lastname.length > 32) {\n      return Response.json({ message: \"Last name must be between 1 to 32 characters\" }, { status: 400 });\n    }\n\n    if (!email) return Response.json({ message: \"email is required\" }, { status: 400 });\n    if (!isEmail(email)) {\n      return Response.json({ message: \"Please enter a valid email address\" }, { status: 400 });\n    }\n\n    if (!telephone) return Response.json({ message: \"telephone is required\" }, { status: 400 });\n    if (!isTenDigitPhone(telephone)) {\n      return Response.json({ message: \"Phone/Mobile must be exactly 10 digits (numbers only)\" }, { status: 400 });\n    }\n\n    // ✅ uniqueness checks (ignore self if updating)\n    const notSelf = incomingAffiliateId ? `AND affiliate_id <> ${incomingAffiliateId}` : \"\";\n\n    const [emailRows] = await db.query(`\n      SELECT affiliate_id\n      FROM affiliate\n      WHERE LOWER(email)=LOWER('${dbEscape(email)}')\n      ${notSelf}\n      LIMIT 1\n    `);\n    if (emailRows?.length) {\n      return Response.json({ message: \"Email already exists\" }, { status: 409 });\n    }\n\n    const [telRows] = await db.query(`\n      SELECT affiliate_id\n      FROM affiliate\n      WHERE telephone='${dbEscape(telephone)}'\n      ${notSelf}\n      LIMIT 1\n    `);\n    if (telRows?.length) {\n      return Response.json({ message: \"Phone/Mobile already exists\" }, { status: 409 });\n    }\n\n    // ✅ If affiliate_id provided and exists -> UPDATE (do NOT insert again)\n    if (incomingAffiliateId) {\n      const existing = await getAffiliateById(incomingAffiliateId);\n      if (existing) {\n        await db.query(`\n          UPDATE affiliate SET\n            firstname='${firstname}',\n            lastname='${lastname}',\n            email='${email}',\n            telephone='${telephone}',\n            ip='${dbEscape(ip)}',\n            date_modified=NOW()\n          WHERE affiliate_id=${incomingAffiliateId}\n          LIMIT 1\n        `);\n\n        await recordAffiliateActivity(affiliate_id, \"register_step1_submit\", {\n          step: 1,\n          firstname: body.firstname,\n          lastname: body.lastname,\n          email: body.email,\n          telephone: body.telephone,\n        }, ip, 120);\n\n        return Response.json({ success: true, step: 1, affiliate_id: incomingAffiliateId, mode: \"updated\" });\n      }\n    }\n\n    // ✅ Otherwise create minimal row (insert)\n    const tempStore = makeTempStoreName();\n\n    // set a temporary password hash (will be overwritten in step3)\n    const salt = generateSalt();\n    const tmpPwd = `tmp-${Date.now()}-${Math.random().toString(16).slice(2)}`;\n    const hashPassword = ocHashPassword(tmpPwd, salt);\n\n    const affiliateSql = `\n      INSERT INTO affiliate SET\n        affiliate_type='0',\n        fees='0',\n        store_name='${dbEscape(tempStore)}',\n        firstname='${firstname}',\n        lastname='${lastname}',\n        email='${email}',\n        from_email='',\n        telephone='${telephone}',\n        fax='',\n        password='${dbEscape(hashPassword)}',\n        salt='${dbEscape(salt)}',\n        company='',\n        website='',\n        address_1='',\n        address_2='',\n        city='',\n        postcode='',\n        country_id='0',\n        zone_id='0',\n        code='',\n        is_customer_own_domain='0',\n        is_domain_available='0',\n        stripe_token='',\n        stripe_customer_id='',\n        stripe_plan_id='',\n        recurring_billing='0',\n        recurring_billing_id='0',\n        start_date=NOW(),\n        end_date=NOW(),\n        store_category_type='0',\n        commission='0',\n        tax='',\n        payment='',\n        cheque='',\n        paypal='',\n        bank_name='',\n        bank_branch_number='',\n        bank_swift_code='',\n        bank_account_name='',\n        bank_account_number='',\n        ip='${dbEscape(ip)}',\n        status='0',\n        newsletter='1',\n        newsletter_text='0',\n        affiliate_status_id='15',\n        approved='0',\n        stop_automation='0',\n        user_added='0',\n        user_modified='0',\n        date_added=NOW(),\n        date_modified=NOW(),\n        date_update=NOW(),\n        is_delete='0'\n    `;\n\n    const [result] = await db.query(affiliateSql);\n    const affiliate_id = result.insertId;\n\n    await recordAffiliateActivity(affiliate_id, \"register_step1_submit\", {\n      step: 1,\n      firstname: body.firstname,\n      lastname: body.lastname,\n      email: body.email,\n      telephone: body.telephone,\n    }, ip, 120);\n\n    return Response.json({ success: true, step: 1, affiliate_id, mode: \"inserted\" });\n  }\n\n  // ------------------------------------------------------------\n  // STEP 2: update plan + business info\n  // ------------------------------------------------------------\n  if (step === 2) {\n    const affiliate_id = Number(body.affiliate_id || 0);\n    if (!affiliate_id) return Response.json({ message: \"affiliate_id is required\" }, { status: 400 });\n\n    const affiliate = await getAffiliateById(affiliate_id);\n    if (!affiliate) return Response.json({ message: \"Affiliate not found\" }, { status: 404 });\n\n    const affiliate_plan_id = Number(body.affiliate_plan_id || 0);\n    const fees = Number(body.fees || 0);\n    const business_name = dbEscape(body.business_name);\n    const website_domain = stripWebsite(body.website || \"\");\n    const website = dbEscape(website_domain);\n\n    const stripe_plan_id = dbEscape(body.stripe_plan_id || \"\");\n\n    const price_schema = Number(body.price_schema || 0);\n    const default_markup = Number(body.default_markup || 0);\n    const retail_price_commission = Number(body.retail_price_commission || 0);\n    const is_catalog_access = body.is_catalog_access;\n\n    // validations step2\n    if (!affiliate_plan_id) {\n      return Response.json({ message: \"affiliate_plan_id is required\" }, { status: 400 });\n    }\n\n    if (!business_name) {\n      return Response.json({ message: \"business_name is required\" }, { status: 400 });\n    }\n    if (business_name.length < 3 || business_name.length > 32) {\n      return Response.json({ message: \"Business name must be between 3 to 32 characters\" }, { status: 400 });\n    }\n\n    // website optional but validate if present\n    if (website_domain) {\n      const domainOk = /^[a-z0-9.-]+\\.[a-z]{2,}$/i.test(website_domain);\n      if (!domainOk) {\n        return Response.json({ message: \"Website must be a valid domain like example.com\" }, { status: 400 });\n      }\n    }\n\n    // uniqueness checks for business_name + website (email/tel already done in step1)\n    const [bizRows] = await db.query(\n      `SELECT affiliate_id FROM affiliate WHERE LOWER(store_name)=LOWER('${dbEscape(business_name)}') AND affiliate_id<>${affiliate_id} LIMIT 1`\n    );\n    if (bizRows?.length) return Response.json({ message: \"Business name already exists\" }, { status: 409 });\n\n    if (website_domain) {\n      const [webRows] = await db.query(\n        `SELECT affiliate_id FROM affiliate WHERE LOWER(website)=LOWER('${dbEscape(website_domain)}') AND affiliate_id<>${affiliate_id} LIMIT 1`\n      );\n      if (webRows?.length) return Response.json({ message: \"Website already exists\" }, { status: 409 });\n    }\n\n    // update\n    await db.query(`\n      UPDATE affiliate SET\n        affiliate_type='${affiliate_plan_id}',\n        fees='${fees}',\n        store_name='${business_name}',\n        website='${website}',\n        stripe_plan_id='${stripe_plan_id}',\n        date_modified=NOW(),\n        ip='${dbEscape(ip)}'\n      WHERE affiliate_id=${affiliate_id}\n    `);\n    \n    await recordAffiliateActivity(affiliate_id, \"register_step2_submit\", {\n      step: 2,\n      affiliate_plan_id,\n      business_name: body.business_name,\n      website: website_domain || \"\",\n    }, ip, 120);\n\n    // NOTE:\n    // price_schema/default_markup/retail_price_commission/is_catalog_access are used later in step3 settings/demo creation.\n    // We keep them in memory from request (client sends again in step3 OR you can store them in affiliate table if you have columns).\n    // For now: client should resend them in step3 as well OR you can store them somewhere.\n    // We will REQUIRE step3 request to include these values again (same as your previous single-step flow).\n\n    return Response.json({ success: true, step: 2, affiliate_id });\n  }\n\n  // ------------------------------------------------------------\n  // STEP 3: update address + password + terms, then run FULL setup\n  // ------------------------------------------------------------\n  if (step === 3) {\n    const affiliate_id = Number(body.affiliate_id || 0);\n    if (!affiliate_id) return Response.json({ message: \"affiliate_id is required\" }, { status: 400 });\n\n    const affiliate = await getAffiliateById(affiliate_id);\n    if (!affiliate) return Response.json({ message: \"Affiliate not found\" }, { status: 404 });\n\n    const address_1 = dbEscape(body.address_1);\n    const address_2 = dbEscape(body.address_2 || \"\");\n    const city = dbEscape(body.city);\n    const postcode = dbEscape(body.postcode);\n    const country_id = Number(body.country_id || 0);\n    const zone_id = Number(body.zone_id || 0);\n\n    const password = dbEscape(body.password ?? \"\");\n    const confirm = dbEscape(body.confirm ?? \"\");\n\n    const agree =\n      body.agree_terms === true ||\n      body.agree_terms === \"true\" ||\n      body.agree_terms === \"1\" ||\n      body.agree_terms === 1;\n\n    // validations step3\n    if (!address_1) return Response.json({ message: \"address_1 is required\" }, { status: 400 });\n    if (!city) return Response.json({ message: \"city is required\" }, { status: 400 });\n    if (!country_id) return Response.json({ message: \"country_id is required\" }, { status: 400 });\n    if (!zone_id) return Response.json({ message: \"zone_id is required\" }, { status: 400 });\n\n    if (!password) return Response.json({ message: \"password is required\" }, { status: 400 });\n    if (password.length < 6 || password.length > 20) {\n      return Response.json({ message: \"Password must be between 6 to 20 characters\" }, { status: 400 });\n    }\n    if (password !== confirm) {\n      return Response.json({ message: \"Passwords do not match\" }, { status: 400 });\n    }\n    if (!agree) {\n      return Response.json({ message: \"You must agree to the Terms & Conditions\" }, { status: 400 });\n    }\n\n    // these must be present for your original setup logic\n    const price_schema = Number(body.price_schema || 0);\n    const default_markup = Number(body.default_markup || 0);\n    const retail_price_commission = Number(body.retail_price_commission || 0);\n    const is_catalog_access = body.is_catalog_access;\n\n    // set real password now\n    const salt = generateSalt();\n    const hashPassword = ocHashPassword(password, salt);\n\n    await db.query(`\n      UPDATE affiliate SET\n        affiliate_status_id='1',\n        address_1='${address_1}',\n        address_2='${address_2}',\n        city='${city}',\n        postcode='${postcode}',\n        country_id='${country_id}',\n        zone_id='${zone_id}',\n        password='${dbEscape(hashPassword)}',\n        salt='${dbEscape(salt)}',\n        date_modified=NOW(),\n        ip='${dbEscape(ip)}'\n      WHERE affiliate_id=${affiliate_id}\n    `);\n    \n    // This event is IMPORTANT for automation rules:\n    // after step3 you redirect to payment page\n    await recordAffiliateActivity(affiliate_id, \"register_step3_submit\", {\n      step: 3,\n      city: body.city,\n      country_id,\n      zone_id,\n    }, ip, 120);\n\n    await recordAffiliateActivity(affiliate_id, \"redirect_to_payment\", {\n      affiliate_id,\n      url: `/register/payment/${affiliate_id}`,\n    }, ip, 120);\n\n    // --------------------------------------------\n    // NOW RUN YOUR ORIGINAL \"heavy\" setup\n    // --------------------------------------------\n    const firstname = dbEscape(aff.firstname || \"\");\n    const lastname = dbEscape(aff.lastname || \"\");\n    const email = dbEscape(String(aff.email || \"\")).toLowerCase();\n    const telephone = dbEscape(aff.telephone || \"\");\n    const business_name = dbEscape(aff.store_name || \"\");\n    const website = dbEscape(aff.website || \"\");\n\n    // 1) Create affiliate_user\n    const username = email;\n\n    const affiliateUserQuery = `INSERT INTO affiliate_user SET\n      affiliate_id='${affiliate_id}',\n      username='${username}',\n      password='${dbEscape(hashPassword)}',\n      salt='${dbEscape(salt)}',\n      firstname='${firstname}',\n      lastname='${lastname}',\n      email='${email}',\n      telephone='${telephone}',\n      image='',\n      code='',\n      ip='${dbEscape(ip)}',\n      status='0',\n      user_added='0',\n      date_added=NOW(),\n      date_modified=NOW(),\n      is_delete=0\n    `;\n\n    await db.query(affiliateUserQuery);\n\n    // 2) Install totals/modules\n    await installModule(\"total\", \"sub_total\", affiliate_id);\n    await addAffiliateSettings(\n      \"affiliate_sub_total\",\n      { affiliate_sub_total_status: \"1\", affiliate_sub_total_sort_order: \"1\" },\n      affiliate_id\n    );\n\n    await installModule(\"total\", \"shipping\", affiliate_id);\n    await addAffiliateSettings(\n      \"affiliate_shipping\",\n      { affiliate_shipping_status: \"2\", affiliate_shipping_sort_order: \"10\" },\n      affiliate_id\n    );\n\n    await installModule(\"total\", \"coupon\", affiliate_id);\n    await addAffiliateSettings(\n      \"affiliate_coupon\",\n      { affiliate_coupon_status: \"1\", affiliate_coupon_sort_order: \"3\" },\n      affiliate_id\n    );\n\n    await installModule(\"total\", \"credit\", affiliate_id);\n    await addAffiliateSettings(\n      \"affiliate_credit\",\n      { affiliate_credit_status: \"1\", affiliate_credit_sort_order: \"4\" },\n      affiliate_id\n    );\n\n    await installModule(\"total\", \"reward\", affiliate_id);\n    await addAffiliateSettings(\n      \"affiliate_reward\",\n      { affiliate_reward_status: \"1\", affiliate_reward_sort_order: \"5\" },\n      affiliate_id\n    );\n\n    await installModule(\"total\", \"total\", affiliate_id);\n    await addAffiliateSettings(\n      \"affiliate_total\",\n      { affiliate_total_status: \"1\", affiliate_total_sort_order: \"100\" },\n      affiliate_id\n    );\n\n    // 3) Affiliate config settings\n    const affiliate_basic_settings = await getAffiliateBasicSettings();\n\n    const affiliate_setting = {};\n\n    if (price_schema === 1 || price_schema === 3) {\n      affiliate_setting[\"affiliate_config_markup\"] = default_markup ? default_markup : 30;\n    } else {\n      affiliate_setting[\"affiliate_config_markup\"] = 0;\n    }\n\n    affiliate_setting[\"affiliate_config_name\"] = business_name;\n    affiliate_setting[\"affiliate_config_url\"] = website;\n    affiliate_setting[\"affiliate_config_owner\"] = `${firstname} ${lastname}`.trim();\n\n    let fullAddress = address_1;\n    if (address_2 && address_2.trim() !== \"\") fullAddress += `, ${address_2}`;\n    fullAddress += `, ${city}`;\n    fullAddress += ` - ${postcode}`;\n\n    affiliate_setting[\"affiliate_config_address\"] = fullAddress;\n\n    affiliate_setting[\"affiliate_config_email\"] = email;\n    affiliate_setting[\"affiliate_config_telephone\"] = telephone;\n    affiliate_setting[\"affiliate_config_visible_telephone\"] = 1;\n    affiliate_setting[\"affiliate_config_meta_title\"] = business_name;\n\n    affiliate_setting[\"affiliate_config_country_id\"] = country_id;\n    affiliate_setting[\"affiliate_config_zone_id\"] = zone_id;\n\n    // ✅ keep your defaults (same as before)\n    affiliate_setting[\"affiliate_config_currency\"] = \"USD\";\n    affiliate_setting[\"affiliate_config_order_status_id\"] = 2;\n    affiliate_setting[\"affiliate_config_processing_status\"] = [2];\n    affiliate_setting[\"affiliate_config_complete_status\"] = [5, 15];\n\n    affiliate_setting[\"affiliate_config_image_category_width\"] = 1200;\n    affiliate_setting[\"affiliate_config_image_category_height\"] = 300;\n    affiliate_setting[\"affiliate_config_image_product_width\"] = 370;\n    affiliate_setting[\"affiliate_config_image_product_height\"] = 370;\n    affiliate_setting[\"affiliate_config_image_popup_width\"] = 1000;\n    affiliate_setting[\"affiliate_config_image_popup_height\"] = 1000;\n    affiliate_setting[\"affiliate_config_image_thumb_width\"] = 370;\n    affiliate_setting[\"affiliate_config_image_thumb_height\"] = 370;\n    affiliate_setting[\"affiliate_config_image_additional_width\"] = 475;\n    affiliate_setting[\"affiliate_config_image_additional_height\"] = 475;\n    affiliate_setting[\"affiliate_config_image_catalog_width\"] = 600;\n    affiliate_setting[\"affiliate_config_image_catalog_height\"] = 482;\n\n    affiliate_setting[\"affiliate_config_template\"] = \"default\";\n    affiliate_setting[\"affiliate_config_checkout_guest\"] = 1;\n    affiliate_setting[\"affiliate_config_apply_store_coupons\"] = 1;\n\n    affiliate_setting[\"affiliate_config_subscribe_status\"] = 1;\n    affiliate_setting[\"affiliate_config_subscribe_heading\"] = \"Subscribe to our Newsletter\";\n    affiliate_setting[\"affiliate_config_subscribe_top_text\"] = `<p style=\"margin-top:15px; line-height: 22px;\">Enter your email address to get the hottest deals Online. </p>\n<p style=\"margin-top:15px; line-height: 22px;\"><span style=\"font-weight: bold;\">You will be the first </span>to know about our offers, new arrivals, and more!<br></p>`;\n    affiliate_setting[\"affiliate_config_subscribe_bottom_text\"] = `<p style=\"line-height: 22px;\">We value our customers and will not share your email address to any third party. You will not be spammed.<br></p>`;\n    affiliate_setting[\"affiliate_config_subscribe_button_text\"] = \"\";\n    affiliate_setting[\"affiliate_config_subscribe_image_position\"] = \"left\";\n    affiliate_setting[\"affiliate_config_subscribe_success\"] =\n      \"Success: Your email address subscribed successfully!\";\n\n    const footer_description =\n      \"We are carrying the biggest collection for church fashions which includes all the designer church suits, church dresses and church hats.\";\n\n    affiliate_setting[\"affiliate_config_footer_description\"] =\n      affiliate_basic_settings?.[\"affiliate_basic_footer_description\"]\n        ? String(affiliate_basic_settings[\"affiliate_basic_footer_description\"])\n        : footer_description;\n\n    affiliate_setting[\"affiliate_config_catalog_column\"] = 3;\n\n    affiliate_setting[\"affiliate_config_pp_standard_email\"] = email;\n    affiliate_setting[\"affiliate_config_pp_standard_status\"] = 1;\n    affiliate_setting[\"affiliate_config_pp_standard_test\"] = 0;\n    affiliate_setting[\"affiliate_config_pp_standard_debug\"] = 0;\n    affiliate_setting[\"affiliate_config_pp_standard_transaction\"] = 1;\n\n    const header_tag_line = \"Leading Church Fashion Brand\";\n    affiliate_setting[\"affiliate_config_tagline\"] =\n      affiliate_basic_settings?.[\"affiliate_basic_tagline\"]\n        ? affiliate_basic_settings[\"affiliate_basic_tagline\"]\n        : header_tag_line;\n\n    affiliate_setting[\"affiliate_config_display_address\"] = 0;\n\n    await addAffiliateSettings(\"affiliate_config\", affiliate_setting, affiliate_id);\n\n    // 4) demo categories/products only if advanced\n    if (isTruthy(is_catalog_access)) {\n      const categories = await addAffiliateCategory(affiliate_id);\n      await addAffiliateProducts(affiliate_id, categories);\n    }\n\n    // 5) default pages\n    await addAffiliatePages(affiliate_id, [\n      { name: \"About Us\", description: \"About Us\", meta_title: \"About Us\", meta_description: \"About Us\", sort_order: \"1\", status: \"1\" },\n    ]);\n\n    // 6) banners + modules\n    await addLargeBanners(affiliate_id);\n    await addSmallBanners(affiliate_id);\n    await addCategoryProductsModule(affiliate_id);\n\n    return Response.json({ success: true, step: 3, affiliate_id });\n  }\n\n  // fallback (should never happen)\n  return Response.json({ message: \"Invalid step\" }, { status: 400 });\n}","import { AppRouteRouteModule } from \"next/dist/esm/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/esm/server/lib/patch-fetch\";\nimport { addRequestMeta, getRequestMeta } from \"next/dist/esm/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { setManifestsSingleton } from \"next/dist/esm/server/app-render/manifests-singleton\";\nimport { normalizeAppPath } from \"next/dist/esm/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/esm/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/esm/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/esm/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/esm/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/esm/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/esm/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/esm/lib/constants\";\nimport { NoFallbackError } from \"next/dist/esm/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/esm/server/response-cache\";\nimport * as userland from \"INNER_APP_ROUTE\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/affiliate/register/route\",\n        pathname: \"/api/affiliate/register\",\n        filename: \"route\",\n        bundlePath: \"\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"[project]/src/app/api/affiliate/register/route.js\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/affiliate/register/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        setManifestsSingleton({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext, silenceLog)=>routeModule.onRequestError(req, error, errorContext, silenceLog, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean(process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        const silenceLog = false;\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, silenceLog, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof NoFallbackError)) {\n            const silenceLog = false;\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            }, silenceLog, routerServerContext);\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n"],"names":[],"mappings":"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","ignoreList":[1]}