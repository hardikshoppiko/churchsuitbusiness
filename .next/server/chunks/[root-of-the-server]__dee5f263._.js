module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},6461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},70947,e=>{"use strict";e.s([])},85066,15577,e=>{"use strict";var t=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)s.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return s},r={N:"null",i:"int",d:"float",b:"boolean",s:"string",a:"array-object",C:"serializable-class",O:"notserializable-class"};function i(e,t,r){this.contents=e,this.index=t,this.options=r}function n(e,t){return"undefined"!=typeof Buffer?Buffer.byteLength(e,t.encoding):encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length}i.prototype.error=function(e){return void 0===e&&(e="Syntax Error"),Error(e+" at index "+this.index+" while unserializing payload")},i.prototype.advance=function(e){this.index+=e},i.prototype.readAhead=function(e){var t=this.peekAhead(e);return this.index+=e,t},i.prototype.readUntil=function(e){var t=this.contents.indexOf(e,this.index);if(-1===t)throw this.error("Expected '"+e+"'");return this.readAhead(t-this.index)},i.prototype.peekAhead=function(e){return this.contents.toString(this.options.encoding,this.index,this.index+e)},i.prototype.seekExpected=function(e){if(this.readAhead(e.length)!==e)throw this.index-=e.length,this.error("Expected '"+e+"'")},i.prototype.getType=function(){var e=t(this.readAhead(2),2),i=e[0],n=e[1],a=r[i];if(!a)throw this.error("Unknown type");if("null"===a?";"!==n:":"!==n)throw this.error();return a},i.prototype.getLength=function(){var e=Number.parseInt(this.readUntil(":"),10);if(Number.isNaN(e))throw this.error();return e},i.prototype.getByLength=function(e,t,r){var i=this.getLength();this.seekExpected(":"+e);var n=r(i);return this.seekExpected(t),n};var a=function(){return(a=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},s=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)s.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return s};function o(e,t){var r=Array.isArray(e)?e.map(function(e,r){return""+l(r,t)+l(e,t)}):Object.keys(e).map(function(r){return""+l(r,t)+l(e[r],t)});return r.filter(function(e){return void 0!==e}).length+":{"+r.join("")+"}"}function l(e,t,r){void 0===t&&(t={}),void 0===r&&(r={});var i,u=typeof e,d=a({},r);if(void 0===d.encoding&&(d.encoding="utf8"),null===e)return"N;";if("number"===u||"bigint"===u)return"bigint"==typeof e||"number"==typeof e&&Number.parseInt(e.toString(),10)===e?"i:"+e+";":"d:"+e.toString().toUpperCase()+";";if("string"===u)return"s:"+n(e,d)+':"'+e+'";';if("boolean"===u)return"b:"+(e?"1":"0")+";";if("object"!==u)throw TypeError("Unexpected type '"+u+"' encountered while attempting to serialize");if(Array.isArray(e)||"Object"===e.constructor.name)return"a:"+o(e,t);if(e instanceof Map)return"a:"+e.size+":{"+Array.from(e.entries()).map(function(e){var r=s(e,2),i=r[0],n=r[1];return""+l(i,t)+l(n,t)}).join("")+"}";var p=Object.keys(i=t).find(function(t){return e instanceof i[t]})||e.__PHP_Incomplete_Class_Name||e.constructor.name;if("function"==typeof e.serialize){var c=e.serialize(),f="string"==typeof c,h=e.constructor.name+".serialize should return a string";if(!f)throw Error(h);return"C:"+p.length+':"'+p+'":'+n(c,d)+":{"+c+"}"}return"O:"+p.length+':"'+p+'":'+o(e,t)}e.s([],85066),e.s(["serialize",()=>l],15577)},38369,e=>{"use strict";e.i(70947);var t=e.i(54799);e.i(85066);var r=e.i(15577);function i(e){return t.default.createHash("sha1").update(String(e)).digest("hex")}function n(){return t.default.createHash("md5").update(t.default.randomBytes(16).toString("hex")+Date.now()).digest("hex").substring(0,9)}function a(e,t){return i(t+i(t+i(e)))}function s(e,t,r){return a(e,t)===r}function o(e){return null==e?"":String(e).replace(/\\/g,"\\\\").replace(/\u0008/g,"\\b").replace(/\t/g,"\\t").replace(/\0/g,"\\0").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u001a/g,"\\Z").replace(/\x1a/g,"\\Z").replace(/'/g,"\\'").replace(/"/g,'\\"')}function l(e=""){return String(e).trim().replace(/^https?:\/\//i,"").replace(/^www\./i,"").replace(/\/+$/,"")}function u(e){return/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(String(e||"").trim())}function d(e){return/^\d{10}$/.test(String(e||"").trim())}function p(e){return String(e||"").trim()}function c(e){return(0,r.serialize)(e)}function f(e){return!0===e||1===e||"1"===e||"true"===String(e).toLowerCase()}function h(e){if(!e?.headers)return"127.0.0.1";let t=e.headers.get("x-forwarded-for");if(t)return t.split(",")[0].trim();let r=e.headers.get("cf-connecting-ip");return r||"127.0.0.1"}e.s(["dbEscape",()=>o,"generateSalt",()=>n,"getClientIp",()=>h,"isEmail",()=>u,"isTenDigitPhone",()=>d,"isTruthy",()=>f,"normalizeLogin",()=>p,"ocHashPassword",()=>a,"ocSerialize",()=>c,"ocVerifyPassword",()=>s,"stripWebsite",()=>l])},80605,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),n=e.i(59756),a=e.i(61916),s=e.i(74677),o=e.i(69741),l=e.i(16795),u=e.i(87718),d=e.i(95169),p=e.i(47587),c=e.i(66012),f=e.i(70101),h=e.i(26937),m=e.i(10372),g=e.i(93695);e.i(52474);var y=e.i(220),_=e.i(79058),x=e.i(38369),v=e.i(55504);async function R(e){let[t]=await _.db.query(`SELECT * FROM affiliate WHERE affiliate_id='${(0,x.dbEscape)(Number(e))}' LIMIT 1`);return t?.[0]||null}async function E(e,t){let r=Object.keys(t).map(e=>`\`${e}\`='${(0,x.dbEscape)(t[e])}'`).join(", ");await _.db.query(`UPDATE affiliate SET ${r}, date_modified=NOW() WHERE affiliate_id='${(0,x.dbEscape)(Number(e))}'`)}async function b(e){let t=await R(e);if(!t)return{affiliate_status:"not_found"};if(void 0!==t.payment_status&&"paid"===String(t.payment_status||"").toLowerCase())return{affiliate_status:"paid"};let r=t.stripe_customer_id||"";if(r||(r=(await v.stripe.customers.create({email:t.email,name:`${t.firstname} ${t.lastname}`,phone:t.telephone,metadata:{affiliate_id:String(t.affiliate_id)}})).id,await E(t.affiliate_id,{stripe_customer_id:r})),t.recurring_billing_id)try{let e=await v.stripe.subscriptions.retrieve(t.recurring_billing_id,{expand:["latest_invoice.payment_intent"]});if("active"===e.status||"trialing"===e.status)return await E(t.affiliate_id,{payment_status:"paid"}),{affiliate_status:"paid"};let r=e.latest_invoice?.payment_intent;if(r?.client_secret)return{affiliate_status:"ready",clientSecret:r.client_secret}}catch(e){}let i=t.stripe_plan_id;if(!i)return{affiliate_status:"error",message:"Stripe plan/price id missing."};let n=await v.stripe.subscriptions.create({customer:r,items:[{price:i}],payment_behavior:"default_incomplete",payment_settings:{payment_method_types:["card"],save_default_payment_method:"on_subscription"},expand:["latest_invoice.payment_intent"],metadata:{affiliate_id:String(t.affiliate_id),affiliate_plan_id:String(t.affiliate_plan_id||"")}}),a=n.latest_invoice?.payment_intent;return a?.client_secret?(await E(t.affiliate_id,{stripe_customer_id:r,recurring_billing_id:n.id,stripe_payment_intent_id:a.id,affiliate_status_id:5}),{affiliate_status:"ready",clientSecret:a.client_secret}):{affiliate_status:"error",message:"Could not create PaymentIntent."}}async function w(e){let t=await e.json().catch(()=>({})),r=t?.affiliate_id;if(!r)return Response.json({message:"affiliate_id is required"},{status:400});let i=await b(r);return"not_found"===i.affiliate_status?Response.json({message:"Affiliate not found"},{status:404}):"paid"===i.affiliate_status?Response.json({affiliate_status:"paid"}):"error"===i.affiliate_status?Response.json({message:i.message||"Payment init failed"},{status:500}):Response.json({affiliate_status:"ready",clientSecret:i.clientSecret})}async function S(e){try{let t=new URL(e.url),r=Number(t.searchParams.get("affiliate_id")||0);if(!r)return Response.json({message:"affiliate_id is required"},{status:400});let[i]=await _.db.query(`SELECT * FROM affiliate WHERE affiliate_id=${r}`),n=i?.[0]||null;if(!n)return Response.json({message:"Affiliate not found"},{status:404});let[a]=await _.db.query(`SELECT affiliate_payment_id, payment_charge_id, invoice_number, amount, start_date, end_date, payment_status, date_added FROM affiliate_payment WHERE affiliate_id=${r} ORDER BY affiliate_payment_id DESC LIMIT 1`),s=a?.[0]||null,[o]=await _.db.query(`SELECT affiliate_payment_id FROM affiliate_payment WHERE affiliate_id=${r} AND payment_status=1 ORDER BY affiliate_payment_id ASC LIMIT 1`),l=o?.length?"renewal":"first";return Response.json({success:!0,affiliate:n,latest_payment:s,payment_stage:l})}catch(e){return Response.json({message:e?.message||"Server error"},{status:500})}}e.s(["GET",()=>S,"POST",()=>w],66903);var C=e.i(66903);let A=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/affiliate/payment-intent/route",pathname:"/api/affiliate/payment-intent",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/affiliate/payment-intent/route.js",nextConfigOutput:"",userland:C}),{workAsyncStorage:O,workUnitAsyncStorage:T,serverHooks:j}=A;function N(){return(0,i.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:T})}async function P(e,t,i){A.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/affiliate/payment-intent/route";_=_.replace(/\/index$/,"")||"/";let x=await A.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:E,parsedUrl:b,isDraftMode:w,prerenderManifest:S,routerServerContext:C,isOnDemandRevalidate:O,revalidateOnlyGenerated:T,resolvedPathname:j,clientReferenceManifest:N,serverActionsManifest:P}=x,q=(0,o.normalizeAppPath)(_),k=!!(S.dynamicRoutes[q]||S.routes[j]),I=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,b,!1):t.end("This page could not be found"),null);if(k&&!w){let e=!!S.routes[j],t=S.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await I();throw new g.NoFallbackError}}let H=null;!k||A.isDev||w||(H="/index"===(H=j)?"/":H);let U=!0===A.isDev||!k,$=k&&!U;P&&N&&(0,s.setManifestsSingleton)({page:_,clientReferenceManifest:N,serverActionsManifest:P});let D=e.method||"GET",L=(0,a.getTracer)(),M=L.getActiveScopeSpan(),z={params:R,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,n)=>A.onRequestError(e,t,i,n,C)},sharedContext:{buildId:v}},F=new l.NodeNextRequest(e),B=new l.NodeNextResponse(t),W=u.NextRequestAdapter.fromNodeNextRequest(F,(0,u.signalFromNodeResponse)(t));try{let s=async e=>A.handle(W,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${D} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${_}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var a,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&O&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(n);e.fetchMetrics=z.renderOpts.fetchMetrics;let l=z.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let u=z.renderOpts.collectedTags;if(!k)return await (0,c.sendResponse)(F,B,a,z.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,i=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:O})},!1,C),t}},d=await A.handleResponse({req:e,nextConfig:E,cacheKey:H,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:T,responseGenerator:u,waitUntil:i.waitUntil,isMinimalMode:o});if(!k)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",O?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&k||g.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,c.sendResponse)(F,B,new Response(d.value.body,{headers:g,status:d.value.status||200})),null};M?await l(M):await L.withPropagatedContext(e.headers,()=>L.trace(d.BaseServerSpan.handleRequest,{spanName:`${D} ${_}`,kind:a.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:O})},!1,C),k)throw t;return await (0,c.sendResponse)(F,B,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>N,"routeModule",()=>A,"serverHooks",()=>j,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>T],80605)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__dee5f263._.js.map