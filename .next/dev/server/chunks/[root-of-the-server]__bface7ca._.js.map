{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/apcrat/Documents/react/church_suit_business/affiliates/src/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\";\n\nexport const db = mysql.createPool({\n  host: process.env.DB_HOST,\n  user: process.env.DB_USER,\n  password: process.env.DB_PASSWORD,\n  database: process.env.DB_NAME,\n  port: Number(process.env.DB_PORT || 3306),\n  waitForConnections: true,\n  connectionLimit: 10,\n});"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,KAAK,8IAAK,CAAC,UAAU,CAAC;IACjC,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;IAC7B,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,oBAAoB;IACpB,iBAAiB;AACnB"}},
    {"offset": {"line": 137, "column": 0}, "map": {"version":3,"sources":["file:///Users/apcrat/Documents/react/church_suit_business/affiliates/src/lib/auth.js"],"sourcesContent":["import { SignJWT, jwtVerify } from \"jose\";\nimport { cookies } from \"next/headers\";\n\nconst COOKIE_NAME = \"wsf_session\";\nconst MAX_AGE_SEC = 60 * 60 * 24 * 7; // 7 days\n\nfunction getSecret() {\n  const s = process.env.AUTH_SECRET;\n  if (!s) throw new Error(\"AUTH_SECRET is missing in .env.local\");\n  return new TextEncoder().encode(s);\n}\n\nexport async function createSession(payload) {\n  const token = await new SignJWT(payload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(`${MAX_AGE_SEC}s`)\n    .sign(getSecret());\n\n  // âœ… cookies() is async in Route Handlers\n  const cookieStore = await cookies();\n\n  cookieStore.set(COOKIE_NAME, token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    path: \"/\",\n    maxAge: MAX_AGE_SEC,\n  });\n\n  return token;\n}\n\nexport async function clearSession() {\n  const cookieStore = await cookies();\n\n  cookieStore.set(COOKIE_NAME, \"\", {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    path: \"/\",\n    maxAge: 0,\n  });\n}\n\nexport async function getSession() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get(COOKIE_NAME)?.value;\n  if (!token) return null;\n\n  try {\n    const { payload } = await jwtVerify(token, getSecret());\n    return payload;\n  } catch {\n    return null;\n  }\n}"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,cAAc;AACpB,MAAM,cAAc,KAAK,KAAK,KAAK,GAAG,SAAS;AAE/C,SAAS;IACP,MAAM,IAAI,QAAQ,GAAG,CAAC,WAAW;IACjC,IAAI,CAAC,GAAG,MAAM,IAAI,MAAM;IACxB,OAAO,IAAI,cAAc,MAAM,CAAC;AAClC;AAEO,eAAe,cAAc,OAAO;IACzC,MAAM,QAAQ,MAAM,IAAI,kKAAO,CAAC,SAC7B,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,GAAG,YAAY,CAAC,CAAC,EACnC,IAAI,CAAC;IAER,yCAAyC;IACzC,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,YAAY,GAAG,CAAC,aAAa,OAAO;QAClC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;IAEA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,YAAY,GAAG,CAAC,aAAa,IAAI;QAC/B,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,cAAc;IAC5C,IAAI,CAAC,OAAO,OAAO;IAEnB,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///Users/apcrat/Documents/react/church_suit_business/affiliates/src/lib/db-utils.js"],"sourcesContent":["import crypto from \"crypto\";\nimport { serialize as phpSerialize } from \"php-serialize\";\n\nexport function sha1(str) {\n  return crypto.createHash(\"sha1\").update(String(str)).digest(\"hex\");\n}\n\n// OpenCart-compatible 9-char salt\nexport function generateSalt() {\n  return crypto\n    .createHash(\"md5\")\n    .update(crypto.randomBytes(16).toString(\"hex\") + Date.now())\n    .digest(\"hex\")\n    .substring(0, 9);\n}\n\n// OpenCart hash: sha1(salt . sha1(salt . sha1(password)))\nexport function ocHashPassword(password, salt) {\n  return sha1(salt + sha1(salt + sha1(password)));\n}\n\nexport function ocVerifyPassword(inputPassword, storedSalt, storedHash) {\n  return ocHashPassword(inputPassword, storedSalt) === storedHash;\n}\n\n// OpenCart-style db escape (like $this->db->escape)\nexport function dbEscape(value) {\n  if (value === null || value === undefined) return \"\";\n  return String(value)\n    .replace(/\\\\/g, \"\\\\\\\\\")\n    .replace(/\\u0008/g, \"\\\\b\")\n    .replace(/\\t/g, \"\\\\t\")\n    .replace(/\\0/g, \"\\\\0\")\n    .replace(/\\n/g, \"\\\\n\")\n    .replace(/\\r/g, \"\\\\r\")\n    .replace(/\\u001a/g, \"\\\\Z\")\n    .replace(/\\x1a/g, \"\\\\Z\")\n    .replace(/'/g, \"\\\\'\")\n    .replace(/\"/g, '\\\\\"');\n}\n\n// Save only domain (remove https:// and www)\nexport function stripWebsite(url = \"\") {\n  return String(url)\n    .trim()\n    .replace(/^https?:\\/\\//i, \"\")\n    .replace(/^www\\./i, \"\")\n    .replace(/\\/+$/, \"\");\n}\n\nexport function isEmail(v) {\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]{2,}$/.test(String(v || \"\").trim());\n}\n\nexport function isTenDigitPhone(v) {\n  return /^\\d{10}$/.test(String(v || \"\").trim());\n}\n\nexport function normalizeLogin(v) {\n  return String(v || \"\").trim();\n}\n\nexport function ocSerialize(value) {\n  return phpSerialize(value);\n}\n\nexport function isTruthy(v) {\n  return v === true || v === 1 || v === \"1\" || String(v).toLowerCase() === \"true\";\n}\n\nexport function getClientIp(req) {\n  if (!req?.headers) return \"127.0.0.1\";\n\n  // Proxy / Load balancer / Vercel\n  const xForwardedFor = req.headers.get(\"x-forwarded-for\");\n  if (xForwardedFor) {\n    // Can be: \"client, proxy1, proxy2\"\n    return xForwardedFor.split(\",\")[0].trim();\n  }\n\n  // Cloudflare\n  const cfIp = req.headers.get(\"cf-connecting-ip\");\n  if (cfIp) return cfIp;\n\n  // Fallback (local dev)\n  return \"127.0.0.1\";\n}\n\nexport function getFrontClientIp() {\n  const h = headers();\n\n  // Common proxy headers\n  const xff = h.get(\"x-forwarded-for\");\n  if (xff) return xff.split(\",\")[0].trim();\n\n  const realIp = h.get(\"x-real-ip\");\n  if (realIp) return realIp.trim();\n\n  // Fallback\n  return \"0.0.0.0\";\n}\n\nexport function money(v) {\n  const n = Number(v || 0);\n  return Number.isFinite(n) ? `$${n.toFixed(2)}` : \"$0.00\";\n}\n\nfunction parseDate(input) {\n  if (!input) return null;\n\n  // Already Date object\n  if (input instanceof Date) {\n    return isNaN(input.getTime()) ? null : input;\n  }\n\n  if (typeof input !== \"string\") return null;\n\n  // ISO or yyyy-mm-dd hh:mm:ss (MySQL)\n  if (/^\\d{4}-\\d{2}-\\d{2}/.test(input)) {\n    const d = new Date(input.replace(\" \", \"T\"));\n    return isNaN(d.getTime()) ? null : d;\n  }\n\n  // dd/mm/yyyy or dd/mm/yyyy hh:mm:ss\n  if (/^\\d{2}\\/\\d{2}\\/\\d{4}/.test(input)) {\n    const [datePart, timePart] = input.split(\" \");\n    const [dd, mm, yyyy] = datePart.split(\"/\");\n\n    const iso = `${yyyy}-${mm}-${dd}${timePart ? \"T\" + timePart : \"\"}`;\n    const d = new Date(iso);\n    return isNaN(d.getTime()) ? null : d;\n  }\n\n  // Fallback: let JS try\n  const d = new Date(input);\n  return isNaN(d.getTime()) ? null : d;\n}\n\n/**\n * Format date as MM/DD/YYYY (default)\n */\nexport function formatDate(input, format = \"MM/DD/YYYY\") {\n  const d = parseDate(input);\n\n  if (!d) return \"\";\n\n  const map = {\n    DD: String(d.getDate()).padStart(2, \"0\"),\n    MM: String(d.getMonth() + 1).padStart(2, \"0\"),\n    YYYY: d.getFullYear(),\n    HH: String(d.getHours()).padStart(2, \"0\"),\n    mm: String(d.getMinutes()).padStart(2, \"0\"),\n    ss: String(d.getSeconds()).padStart(2, \"0\"),\n  };\n\n  return format.replace(/DD|MM|YYYY|HH|mm|ss/g, (k) => map[k]);\n}"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAAA;;;AAEO,SAAS,KAAK,GAAG;IACtB,OAAO,gHAAM,CAAC,UAAU,CAAC,QAAQ,MAAM,CAAC,OAAO,MAAM,MAAM,CAAC;AAC9D;AAGO,SAAS;IACd,OAAO,gHAAM,CACV,UAAU,CAAC,OACX,MAAM,CAAC,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC,SAAS,KAAK,GAAG,IACxD,MAAM,CAAC,OACP,SAAS,CAAC,GAAG;AAClB;AAGO,SAAS,eAAe,QAAQ,EAAE,IAAI;IAC3C,OAAO,KAAK,OAAO,KAAK,OAAO,KAAK;AACtC;AAEO,SAAS,iBAAiB,aAAa,EAAE,UAAU,EAAE,UAAU;IACpE,OAAO,eAAe,eAAe,gBAAgB;AACvD;AAGO,SAAS,SAAS,KAAK;IAC5B,IAAI,UAAU,QAAQ,UAAU,WAAW,OAAO;IAClD,OAAO,OAAO,OACX,OAAO,CAAC,OAAO,QACf,OAAO,CAAC,WAAW,OACnB,OAAO,CAAC,OAAO,OACf,OAAO,CAAC,OAAO,OACf,OAAO,CAAC,OAAO,OACf,OAAO,CAAC,OAAO,OACf,OAAO,CAAC,WAAW,OACnB,OAAO,CAAC,SAAS,OACjB,OAAO,CAAC,MAAM,OACd,OAAO,CAAC,MAAM;AACnB;AAGO,SAAS,aAAa,MAAM,EAAE;IACnC,OAAO,OAAO,KACX,IAAI,GACJ,OAAO,CAAC,iBAAiB,IACzB,OAAO,CAAC,WAAW,IACnB,OAAO,CAAC,QAAQ;AACrB;AAEO,SAAS,QAAQ,CAAC;IACvB,OAAO,gCAAgC,IAAI,CAAC,OAAO,KAAK,IAAI,IAAI;AAClE;AAEO,SAAS,gBAAgB,CAAC;IAC/B,OAAO,WAAW,IAAI,CAAC,OAAO,KAAK,IAAI,IAAI;AAC7C;AAEO,SAAS,eAAe,CAAC;IAC9B,OAAO,OAAO,KAAK,IAAI,IAAI;AAC7B;AAEO,SAAS,YAAY,KAAK;IAC/B,OAAO,IAAA,kNAAY,EAAC;AACtB;AAEO,SAAS,SAAS,CAAC;IACxB,OAAO,MAAM,QAAQ,MAAM,KAAK,MAAM,OAAO,OAAO,GAAG,WAAW,OAAO;AAC3E;AAEO,SAAS,YAAY,GAAG;IAC7B,IAAI,CAAC,KAAK,SAAS,OAAO;IAE1B,iCAAiC;IACjC,MAAM,gBAAgB,IAAI,OAAO,CAAC,GAAG,CAAC;IACtC,IAAI,eAAe;QACjB,mCAAmC;QACnC,OAAO,cAAc,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IACzC;IAEA,aAAa;IACb,MAAM,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC;IAC7B,IAAI,MAAM,OAAO;IAEjB,uBAAuB;IACvB,OAAO;AACT;AAEO,SAAS;IACd,MAAM,IAAI;IAEV,uBAAuB;IACvB,MAAM,MAAM,EAAE,GAAG,CAAC;IAClB,IAAI,KAAK,OAAO,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IAEtC,MAAM,SAAS,EAAE,GAAG,CAAC;IACrB,IAAI,QAAQ,OAAO,OAAO,IAAI;IAE9B,WAAW;IACX,OAAO;AACT;AAEO,SAAS,MAAM,CAAC;IACrB,MAAM,IAAI,OAAO,KAAK;IACtB,OAAO,OAAO,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,OAAO,CAAC,IAAI,GAAG;AACnD;AAEA,SAAS,UAAU,KAAK;IACtB,IAAI,CAAC,OAAO,OAAO;IAEnB,sBAAsB;IACtB,IAAI,iBAAiB,MAAM;QACzB,OAAO,MAAM,MAAM,OAAO,MAAM,OAAO;IACzC;IAEA,IAAI,OAAO,UAAU,UAAU,OAAO;IAEtC,qCAAqC;IACrC,IAAI,qBAAqB,IAAI,CAAC,QAAQ;QACpC,MAAM,IAAI,IAAI,KAAK,MAAM,OAAO,CAAC,KAAK;QACtC,OAAO,MAAM,EAAE,OAAO,MAAM,OAAO;IACrC;IAEA,oCAAoC;IACpC,IAAI,uBAAuB,IAAI,CAAC,QAAQ;QACtC,MAAM,CAAC,UAAU,SAAS,GAAG,MAAM,KAAK,CAAC;QACzC,MAAM,CAAC,IAAI,IAAI,KAAK,GAAG,SAAS,KAAK,CAAC;QAEtC,MAAM,MAAM,GAAG,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE,KAAK,WAAW,MAAM,WAAW,IAAI;QAClE,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,MAAM,EAAE,OAAO,MAAM,OAAO;IACrC;IAEA,uBAAuB;IACvB,MAAM,IAAI,IAAI,KAAK;IACnB,OAAO,MAAM,EAAE,OAAO,MAAM,OAAO;AACrC;AAKO,SAAS,WAAW,KAAK,EAAE,SAAS,YAAY;IACrD,MAAM,IAAI,UAAU;IAEpB,IAAI,CAAC,GAAG,OAAO;IAEf,MAAM,MAAM;QACV,IAAI,OAAO,EAAE,OAAO,IAAI,QAAQ,CAAC,GAAG;QACpC,IAAI,OAAO,EAAE,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;QACzC,MAAM,EAAE,WAAW;QACnB,IAAI,OAAO,EAAE,QAAQ,IAAI,QAAQ,CAAC,GAAG;QACrC,IAAI,OAAO,EAAE,UAAU,IAAI,QAAQ,CAAC,GAAG;QACvC,IAAI,OAAO,EAAE,UAAU,IAAI,QAAQ,CAAC,GAAG;IACzC;IAEA,OAAO,OAAO,OAAO,CAAC,wBAAwB,CAAC,IAAM,GAAG,CAAC,EAAE;AAC7D"}},
    {"offset": {"line": 337, "column": 0}, "map": {"version":3,"sources":["file:///Users/apcrat/Documents/react/church_suit_business/affiliates/src/app/api/account/login/route.js"],"sourcesContent":["// src/app/api/account/login/route.js\nimport { db } from \"@/lib/db\";\nimport { createSession } from \"@/lib/auth\";\nimport { ocVerifyPassword, isTenDigitPhone, normalizeLogin } from \"@/lib/db-utils\";\n\nexport async function POST(req) {\n  try {\n    const body = await req.json().catch(() => ({}));\n\n    console.log(body);\n\n    const username = normalizeLogin(body.username); // email OR phone\n    const password = String(body.password || \"\");\n\n    if (!username) {\n      return Response.json({ success: false, message: \"Email or phone is required\" }, { status: 400 });\n    }\n    if (!password) {\n      return Response.json({ success: false, message: \"Password is required\" }, { status: 400 });\n    }\n\n    const isPhone = isTenDigitPhone(username);\n\n    const [rows] = await db.query(\n      isPhone\n        ? \"SELECT * FROM affiliate_user WHERE REPLACE(telephone,' ','')=? LIMIT 1\"\n        : \"SELECT * FROM affiliate_user WHERE LOWER(email)=LOWER(?) LIMIT 1\",\n      [username]\n    );\n\n    const user = rows?.[0];\n    if (!user) {\n      return Response.json({ success: false, message: \"Invalid Email/Mobile or password\" }, { status: 401 });\n    }\n\n    if (Number(user.status) !== 1) {\n      return Response.json(\n        { success: false, message: \"Your account is inactive. Please contact support.\" },\n        { status: 403 }\n      );\n    }\n\n    const ok = ocVerifyPassword(password, user.salt, user.password);\n    if (!ok) {\n      return Response.json({ success: false, message: \"Invalid login or password\" }, { status: 401 });\n    }\n\n    await createSession({\n      affiliate_user_id: Number(user.affiliate_user_id),\n      affiliate_id: Number(user.affiliate_id),\n      email: String(user.email || \"\"),\n      telephone: String(user.telephone || \"\"),\n      firstname: String(user.firstname || \"\"),\n      lastname: String(user.lastname || \"\"),\n    });\n\n    return Response.json({\n      success: true,\n      loggedIn: true,\n      message: \"Logged in\",\n      user: {\n        affiliate_user_id: Number(user.affiliate_user_id),\n        affiliate_id: Number(user.affiliate_id),\n        firstname: user.firstname,\n        lastname: user.lastname,\n        email: user.email,\n        telephone: user.telephone,\n      },\n    });\n  } catch (e) {\n    console.error(\"Login failed:\", e);\n    return Response.json(\n      { success: false, message: \"Login failed\", error: process.env.NODE_ENV !== \"production\" ? String(e?.message || e) : undefined },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA,qCAAqC;AACrC;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAG;IAC5B,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAE7C,QAAQ,GAAG,CAAC;QAEZ,MAAM,WAAW,IAAA,6IAAc,EAAC,KAAK,QAAQ,GAAG,iBAAiB;QACjE,MAAM,WAAW,OAAO,KAAK,QAAQ,IAAI;QAEzC,IAAI,CAAC,UAAU;YACb,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAChG;QACA,IAAI,CAAC,UAAU;YACb,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC1F;QAEA,MAAM,UAAU,IAAA,8IAAe,EAAC;QAEhC,MAAM,CAAC,KAAK,GAAG,MAAM,wHAAE,CAAC,KAAK,CAC3B,UACI,2EACA,oEACJ;YAAC;SAAS;QAGZ,MAAM,OAAO,MAAM,CAAC,EAAE;QACtB,IAAI,CAAC,MAAM;YACT,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAAmC,GAAG;gBAAE,QAAQ;YAAI;QACtG;QAEA,IAAI,OAAO,KAAK,MAAM,MAAM,GAAG;YAC7B,OAAO,SAAS,IAAI,CAClB;gBAAE,SAAS;gBAAO,SAAS;YAAoD,GAC/E;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,KAAK,IAAA,+IAAgB,EAAC,UAAU,KAAK,IAAI,EAAE,KAAK,QAAQ;QAC9D,IAAI,CAAC,IAAI;YACP,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QAC/F;QAEA,MAAM,IAAA,qIAAa,EAAC;YAClB,mBAAmB,OAAO,KAAK,iBAAiB;YAChD,cAAc,OAAO,KAAK,YAAY;YACtC,OAAO,OAAO,KAAK,KAAK,IAAI;YAC5B,WAAW,OAAO,KAAK,SAAS,IAAI;YACpC,WAAW,OAAO,KAAK,SAAS,IAAI;YACpC,UAAU,OAAO,KAAK,QAAQ,IAAI;QACpC;QAEA,OAAO,SAAS,IAAI,CAAC;YACnB,SAAS;YACT,UAAU;YACV,SAAS;YACT,MAAM;gBACJ,mBAAmB,OAAO,KAAK,iBAAiB;gBAChD,cAAc,OAAO,KAAK,YAAY;gBACtC,WAAW,KAAK,SAAS;gBACzB,UAAU,KAAK,QAAQ;gBACvB,OAAO,KAAK,KAAK;gBACjB,WAAW,KAAK,SAAS;YAC3B;QACF;IACF,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,SAAS,IAAI,CAClB;YAAE,SAAS;YAAO,SAAS;YAAgB,OAAO,uCAAwC,OAAO,GAAG,WAAW,KAAK;QAAU,GAC9H;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}